<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="author" content="WMB Edmands" />

<meta name="date" content="2015-11-12" />

<title>MetMSLine Basics</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; }
code > span.dt { color: #902000; }
code > span.dv { color: #40a070; }
code > span.bn { color: #40a070; }
code > span.fl { color: #40a070; }
code > span.ch { color: #4070a0; }
code > span.st { color: #4070a0; }
code > span.co { color: #60a0b0; font-style: italic; }
code > span.ot { color: #007020; }
code > span.al { color: #ff0000; font-weight: bold; }
code > span.fu { color: #06287e; }
code > span.er { color: #ff0000; font-weight: bold; }
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<link href="data:text/css,body%20%7B%0A%20%20background%2Dcolor%3A%20%23fff%3B%0A%20%20margin%3A%201em%20auto%3B%0A%20%20max%2Dwidth%3A%20700px%3B%0A%20%20overflow%3A%20visible%3B%0A%20%20padding%2Dleft%3A%202em%3B%0A%20%20padding%2Dright%3A%202em%3B%0A%20%20font%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0A%20%20font%2Dsize%3A%2014px%3B%0A%20%20line%2Dheight%3A%201%2E35%3B%0A%7D%0A%0A%23header%20%7B%0A%20%20text%2Dalign%3A%20center%3B%0A%7D%0A%0A%23TOC%20%7B%0A%20%20clear%3A%20both%3B%0A%20%20margin%3A%200%200%2010px%2010px%3B%0A%20%20padding%3A%204px%3B%0A%20%20width%3A%20400px%3B%0A%20%20border%3A%201px%20solid%20%23CCCCCC%3B%0A%20%20border%2Dradius%3A%205px%3B%0A%0A%20%20background%2Dcolor%3A%20%23f6f6f6%3B%0A%20%20font%2Dsize%3A%2013px%3B%0A%20%20line%2Dheight%3A%201%2E3%3B%0A%7D%0A%20%20%23TOC%20%2Etoctitle%20%7B%0A%20%20%20%20font%2Dweight%3A%20bold%3B%0A%20%20%20%20font%2Dsize%3A%2015px%3B%0A%20%20%20%20margin%2Dleft%3A%205px%3B%0A%20%20%7D%0A%0A%20%20%23TOC%20ul%20%7B%0A%20%20%20%20padding%2Dleft%3A%2040px%3B%0A%20%20%20%20margin%2Dleft%3A%20%2D1%2E5em%3B%0A%20%20%20%20margin%2Dtop%3A%205px%3B%0A%20%20%20%20margin%2Dbottom%3A%205px%3B%0A%20%20%7D%0A%20%20%23TOC%20ul%20ul%20%7B%0A%20%20%20%20margin%2Dleft%3A%20%2D2em%3B%0A%20%20%7D%0A%20%20%23TOC%20li%20%7B%0A%20%20%20%20line%2Dheight%3A%2016px%3B%0A%20%20%7D%0A%0Atable%20%7B%0A%20%20margin%3A%201em%20auto%3B%0A%20%20border%2Dwidth%3A%201px%3B%0A%20%20border%2Dcolor%3A%20%23DDDDDD%3B%0A%20%20border%2Dstyle%3A%20outset%3B%0A%20%20border%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0A%20%20border%2Dwidth%3A%202px%3B%0A%20%20padding%3A%205px%3B%0A%20%20border%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0A%20%20border%2Dwidth%3A%201px%3B%0A%20%20border%2Dstyle%3A%20inset%3B%0A%20%20line%2Dheight%3A%2018px%3B%0A%20%20padding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0A%20%20border%2Dleft%2Dstyle%3A%20none%3B%0A%20%20border%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0A%20%20background%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0A%0Ap%20%7B%0A%20%20margin%3A%200%2E5em%200%3B%0A%7D%0A%0Ablockquote%20%7B%0A%20%20background%2Dcolor%3A%20%23f6f6f6%3B%0A%20%20padding%3A%200%2E25em%200%2E75em%3B%0A%7D%0A%0Ahr%20%7B%0A%20%20border%2Dstyle%3A%20solid%3B%0A%20%20border%3A%20none%3B%0A%20%20border%2Dtop%3A%201px%20solid%20%23777%3B%0A%20%20margin%3A%2028px%200%3B%0A%7D%0A%0Adl%20%7B%0A%20%20margin%2Dleft%3A%200%3B%0A%7D%0A%20%20dl%20dd%20%7B%0A%20%20%20%20margin%2Dbottom%3A%2013px%3B%0A%20%20%20%20margin%2Dleft%3A%2013px%3B%0A%20%20%7D%0A%20%20dl%20dt%20%7B%0A%20%20%20%20font%2Dweight%3A%20bold%3B%0A%20%20%7D%0A%0Aul%20%7B%0A%20%20margin%2Dtop%3A%200%3B%0A%7D%0A%20%20ul%20li%20%7B%0A%20%20%20%20list%2Dstyle%3A%20circle%20outside%3B%0A%20%20%7D%0A%20%20ul%20ul%20%7B%0A%20%20%20%20margin%2Dbottom%3A%200%3B%0A%20%20%7D%0A%0Apre%2C%20code%20%7B%0A%20%20background%2Dcolor%3A%20%23f7f7f7%3B%0A%20%20border%2Dradius%3A%203px%3B%0A%20%20color%3A%20%23333%3B%0A%7D%0Apre%20%7B%0A%20%20white%2Dspace%3A%20pre%2Dwrap%3B%20%20%20%20%2F%2A%20Wrap%20long%20lines%20%2A%2F%0A%20%20border%2Dradius%3A%203px%3B%0A%20%20margin%3A%205px%200px%2010px%200px%3B%0A%20%20padding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0A%20%20background%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0A%0Acode%20%7B%0A%20%20font%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0A%20%20font%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0A%20%20padding%3A%202px%200px%3B%0A%7D%0A%0Adiv%2Efigure%20%7B%0A%20%20text%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0A%20%20background%2Dcolor%3A%20%23FFFFFF%3B%0A%20%20padding%3A%202px%3B%0A%20%20border%3A%201px%20solid%20%23DDDDDD%3B%0A%20%20border%2Dradius%3A%203px%3B%0A%20%20border%3A%201px%20solid%20%23CCCCCC%3B%0A%20%20margin%3A%200%205px%3B%0A%7D%0A%0Ah1%20%7B%0A%20%20margin%2Dtop%3A%200%3B%0A%20%20font%2Dsize%3A%2035px%3B%0A%20%20line%2Dheight%3A%2040px%3B%0A%7D%0A%0Ah2%20%7B%0A%20%20border%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0A%20%20padding%2Dtop%3A%2010px%3B%0A%20%20padding%2Dbottom%3A%202px%3B%0A%20%20font%2Dsize%3A%20145%25%3B%0A%7D%0A%0Ah3%20%7B%0A%20%20border%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0A%20%20padding%2Dtop%3A%2010px%3B%0A%20%20font%2Dsize%3A%20120%25%3B%0A%7D%0A%0Ah4%20%7B%0A%20%20border%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0A%20%20margin%2Dleft%3A%208px%3B%0A%20%20font%2Dsize%3A%20105%25%3B%0A%7D%0A%0Ah5%2C%20h6%20%7B%0A%20%20border%2Dbottom%3A%201px%20solid%20%23ccc%3B%0A%20%20font%2Dsize%3A%20105%25%3B%0A%7D%0A%0Aa%20%7B%0A%20%20color%3A%20%230033dd%3B%0A%20%20text%2Ddecoration%3A%20none%3B%0A%7D%0A%20%20a%3Ahover%20%7B%0A%20%20%20%20color%3A%20%236666ff%3B%20%7D%0A%20%20a%3Avisited%20%7B%0A%20%20%20%20color%3A%20%23800080%3B%20%7D%0A%20%20a%3Avisited%3Ahover%20%7B%0A%20%20%20%20color%3A%20%23BB00BB%3B%20%7D%0A%20%20a%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0A%20%20%20%20text%2Ddecoration%3A%20underline%3B%20%7D%0A%20%20a%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0A%20%20%20%20text%2Ddecoration%3A%20underline%3B%20%7D%0A%0A%2F%2A%20Class%20described%20in%20https%3A%2F%2Fbenjeffrey%2Ecom%2Fposts%2Fpandoc%2Dsyntax%2Dhighlighting%2Dcss%0A%20%20%20Colours%20from%20https%3A%2F%2Fgist%2Egithub%2Ecom%2Frobsimmons%2F1172277%20%2A%2F%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%2F%2A%20Keyword%20%2A%2F%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%2F%2A%20DataType%20%2A%2F%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%2F%2A%20DecVal%20%28decimal%20values%29%20%2A%2F%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20BaseN%20%2A%2F%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20Float%20%2A%2F%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20Char%20%2A%2F%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20String%20%2A%2F%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%2F%2A%20Comment%20%2A%2F%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%2F%2A%20OtherToken%20%2A%2F%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%2F%2A%20AlertToken%20%2A%2F%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%2F%2A%20Function%20calls%20%2A%2F%20%0Acode%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%2F%2A%20ErrorTok%20%2A%2F%0A%0A" rel="stylesheet" type="text/css" />

</head>

<body>



<div id="header">
<h1 class="title">MetMSLine Basics</h1>
<h4 class="author"><em>WMB Edmands</em></h4>
<h4 class="date"><em>November 12, 2015</em></h4>
</div>


<p>The following illustrates the automated MetMSLine workflow with example data for those less familiar with R and the command line interface. R is primarily an interactive programming language, however a degree of automation can be acheived by the usage of wrapper functions, that is software functions that ‘wrap’ together several other software functions.</p>
<div id="getting-started." class="section level2">
<h2>Getting started.</h2>
<p>Install all of the latest package dependencies needed for proper/ complete functionality of MetMSLine. Copy and paste the following command into R and hit enter:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install.packages</span>(<span class="kw">c</span>( <span class="st">'ff'</span>, <span class="st">'dynamicTreeCut'</span>, <span class="st">'data.table'</span>, <span class="st">'reshape2'</span>, <span class="st">'foreach'</span>))</code></pre>
<p>This may take several minutes.</p>
<p>Read in example peak table and co-variates and pre-process the data. Run the following code in the same R session at the command line (i.e. copy and paste the lines and hit enter):</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># read in table of synthetic MS1 metabolomic profiling data</span>
peakTable &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">&quot;extdata&quot;</span>, <span class="st">&quot;synthetic_MS_data.csv&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;MetMSLine&quot;</span>)
peakTable &lt;-<span class="st"> </span><span class="kw">read.csv</span>(peakTable, <span class="dt">header=</span>T, <span class="dt">stringsAsFactors=</span>F)


<span class="co"># load synthetic co-variates table in comma delimited csv file</span>
coVariates &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">&quot;extdata&quot;</span>, <span class="st">&quot;synthetic_coVar_data.csv&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;MetMSLine&quot;</span>)
coVariates &lt;-<span class="st"> </span><span class="kw">read.csv</span>(coVariates, <span class="dt">header=</span>T)</code></pre>
<p>Next we need to establish the names of the samples, these observation names will be used to identify the correct column names in the peak table.</p>
<p>By entering the command colnames we can see all of the names of the columns in our peak table:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">colnames</span>(peakTable)</code></pre>
<pre><code>##   [1] &quot;EIC&quot;              &quot;mzmed&quot;            &quot;rtmed&quot;           
##   [4] &quot;name&quot;             &quot;fold&quot;             &quot;tstat&quot;           
##   [7] &quot;pvalue&quot;           &quot;anova&quot;            &quot;mzmin&quot;           
##  [10] &quot;mzmax&quot;            &quot;rtmin&quot;            &quot;rtmax&quot;           
##  [13] &quot;npeaks&quot;           &quot;Blanks&quot;           &quot;QCs&quot;             
##  [16] &quot;Samples&quot;          &quot;metlin&quot;           &quot;QC_1_1&quot;          
##  [19] &quot;QC_2_2&quot;           &quot;QC_3_3&quot;           &quot;QC_4_4&quot;          
##  [22] &quot;QC_5_5&quot;           &quot;QC_6_6&quot;           &quot;QC_7_7&quot;          
##  [25] &quot;QC_8_8&quot;           &quot;QC_9_9&quot;           &quot;QC_10_10&quot;        
##  [28] &quot;sample_90148_11&quot;  &quot;sample_20692_12&quot;  &quot;sample_105762_13&quot;
##  [31] &quot;sample_80259_14&quot;  &quot;QC_11_15&quot;         &quot;sample_75940_16&quot; 
##  [34] &quot;sample_72889_17&quot;  &quot;sample_83233_18&quot;  &quot;sample_53839_19&quot; 
##  [37] &quot;QC_12_20&quot;         &quot;sample_2492_21&quot;   &quot;sample_61966_22&quot; 
##  [40] &quot;sample_84401_23&quot;  &quot;sample_16265_24&quot;  &quot;QC_13_25&quot;        
##  [43] &quot;sample_65762_26&quot;  &quot;sample_69316_27&quot;  &quot;sample_88848_28&quot; 
##  [46] &quot;sample_25450_29&quot;  &quot;QC_14_30&quot;         &quot;sample_63664_31&quot; 
##  [49] &quot;sample_65099_32&quot;  &quot;sample_22679_33&quot;  &quot;sample_85614_34&quot; 
##  [52] &quot;QC_15_35&quot;         &quot;sample_6115_36&quot;   &quot;sample_31433_37&quot; 
##  [55] &quot;sample_63088_38&quot;  &quot;sample_44970_39&quot;  &quot;QC_16_40&quot;        
##  [58] &quot;sample_68093_41&quot;  &quot;sample_46969_42&quot;  &quot;sample_81427_43&quot; 
##  [61] &quot;sample_41979_44&quot;  &quot;QC_17_45&quot;         &quot;sample_35776_46&quot; 
##  [64] &quot;sample_74037_47&quot;  &quot;sample_24059_48&quot;  &quot;sample_35644_49&quot; 
##  [67] &quot;QC_18_50&quot;         &quot;sample_66742_51&quot;  &quot;sample_26783_52&quot; 
##  [70] &quot;sample_59605_53&quot;  &quot;sample_26363_54&quot;  &quot;QC_19_55&quot;        
##  [73] &quot;sample_105320_56&quot; &quot;sample_80224_57&quot;  &quot;sample_60050_58&quot; 
##  [76] &quot;sample_44059_59&quot;  &quot;QC_20_60&quot;         &quot;sample_85303_61&quot; 
##  [79] &quot;sample_107459_62&quot; &quot;sample_79428_63&quot;  &quot;sample_102682_64&quot;
##  [82] &quot;QC_10_65&quot;         &quot;sample_73599_66&quot;  &quot;sample_22777_67&quot; 
##  [85] &quot;sample_1587_68&quot;   &quot;sample_68869_69&quot;  &quot;QC_11_70&quot;        
##  [88] &quot;sample_10915_71&quot;  &quot;sample_99476_72&quot;  &quot;sample_14240_73&quot; 
##  [91] &quot;sample_68158_74&quot;  &quot;QC_12_75&quot;         &quot;sample_44297_76&quot; 
##  [94] &quot;sample_102649_77&quot; &quot;sample_43569_78&quot;  &quot;sample_110133_79&quot;
##  [97] &quot;QC_13_80&quot;         &quot;sample_82261_81&quot;  &quot;sample_91768_82&quot; 
## [100] &quot;sample_75524_83&quot;  &quot;sample_41343_84&quot;  &quot;QC_14_85&quot;        
## [103] &quot;sample_10078_86&quot;  &quot;sample_66518_87&quot;  &quot;sample_90107_88&quot; 
## [106] &quot;sample_27336_89&quot;  &quot;QC_15_90&quot;         &quot;sample_111469_91&quot;
## [109] &quot;sample_89994_92&quot;  &quot;sample_91108_93&quot;  &quot;sample_48921_94&quot; 
## [112] &quot;QC_16_95&quot;         &quot;sample_3918_96&quot;   &quot;sample_111304_97&quot;
## [115] &quot;sample_45723_98&quot;  &quot;sample_19738_99&quot;  &quot;QC_17_100&quot;       
## [118] &quot;sample_18558_101&quot; &quot;sample_85913_102&quot; &quot;sample_21652_103&quot;
## [121] &quot;sample_59941_104&quot; &quot;QC_18_105&quot;        &quot;sample_36849_106&quot;
## [124] &quot;sample_20031_107&quot; &quot;sample_50189_108&quot; &quot;sample_43370_109&quot;
## [127] &quot;blank_1_110&quot;      &quot;blank_2_111&quot;      &quot;blank_3_112&quot;</code></pre>
<p>The synthetic peak table appears very similar to output from the XCMS peak picking software (specifically the <strong>?xcms::diffreport</strong> function).</p>
<p>We can see that there are many columns containing important information about each LC-MS variable such as the median mass-to-charge (“mzmed”) and the median retention time (“rtmed”) for example. Regardless of peak picking software (xcms or otherwise) a peak-picker output table in its most basic interpretation will almost always consist of rows of LC-MS variables and columns corresponding LC-MS variable information and sample peak intensity/ height information.</p>
<p>In order for MetMSLine to work it must know the column names which correspond to the observation/ sample peak intensity information. In certain cases such as lowess smoothing MetMSLine must also be supplied with the names of quality control samples also in order to distinguish these from other samples.</p>
<p>We can see that from column 18 to the last column there are observation columns. Within which we can see quality controls containing the character string “QC_”, blanks (i.e. negative controls) containing the character string “blank_” and also samples containing the character string “sample_”. These unique character strings can be then be used to quickly identify the correct column names to supply to MetMSLine within your R session, like so:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># observation names (i.e. sample names) by regular expression (?grep)</span>
<span class="co"># all observation names</span>
obsNames &lt;-<span class="st"> </span><span class="kw">colnames</span>(peakTable)[<span class="kw">grep</span>(<span class="st">&quot;QC_|sample_|blank_&quot;</span>, <span class="kw">colnames</span>(peakTable))]
<span class="co"># print all the observation names</span>
obsNames</code></pre>
<pre><code>##   [1] &quot;QC_1_1&quot;           &quot;QC_2_2&quot;           &quot;QC_3_3&quot;          
##   [4] &quot;QC_4_4&quot;           &quot;QC_5_5&quot;           &quot;QC_6_6&quot;          
##   [7] &quot;QC_7_7&quot;           &quot;QC_8_8&quot;           &quot;QC_9_9&quot;          
##  [10] &quot;QC_10_10&quot;         &quot;sample_90148_11&quot;  &quot;sample_20692_12&quot; 
##  [13] &quot;sample_105762_13&quot; &quot;sample_80259_14&quot;  &quot;QC_11_15&quot;        
##  [16] &quot;sample_75940_16&quot;  &quot;sample_72889_17&quot;  &quot;sample_83233_18&quot; 
##  [19] &quot;sample_53839_19&quot;  &quot;QC_12_20&quot;         &quot;sample_2492_21&quot;  
##  [22] &quot;sample_61966_22&quot;  &quot;sample_84401_23&quot;  &quot;sample_16265_24&quot; 
##  [25] &quot;QC_13_25&quot;         &quot;sample_65762_26&quot;  &quot;sample_69316_27&quot; 
##  [28] &quot;sample_88848_28&quot;  &quot;sample_25450_29&quot;  &quot;QC_14_30&quot;        
##  [31] &quot;sample_63664_31&quot;  &quot;sample_65099_32&quot;  &quot;sample_22679_33&quot; 
##  [34] &quot;sample_85614_34&quot;  &quot;QC_15_35&quot;         &quot;sample_6115_36&quot;  
##  [37] &quot;sample_31433_37&quot;  &quot;sample_63088_38&quot;  &quot;sample_44970_39&quot; 
##  [40] &quot;QC_16_40&quot;         &quot;sample_68093_41&quot;  &quot;sample_46969_42&quot; 
##  [43] &quot;sample_81427_43&quot;  &quot;sample_41979_44&quot;  &quot;QC_17_45&quot;        
##  [46] &quot;sample_35776_46&quot;  &quot;sample_74037_47&quot;  &quot;sample_24059_48&quot; 
##  [49] &quot;sample_35644_49&quot;  &quot;QC_18_50&quot;         &quot;sample_66742_51&quot; 
##  [52] &quot;sample_26783_52&quot;  &quot;sample_59605_53&quot;  &quot;sample_26363_54&quot; 
##  [55] &quot;QC_19_55&quot;         &quot;sample_105320_56&quot; &quot;sample_80224_57&quot; 
##  [58] &quot;sample_60050_58&quot;  &quot;sample_44059_59&quot;  &quot;QC_20_60&quot;        
##  [61] &quot;sample_85303_61&quot;  &quot;sample_107459_62&quot; &quot;sample_79428_63&quot; 
##  [64] &quot;sample_102682_64&quot; &quot;QC_10_65&quot;         &quot;sample_73599_66&quot; 
##  [67] &quot;sample_22777_67&quot;  &quot;sample_1587_68&quot;   &quot;sample_68869_69&quot; 
##  [70] &quot;QC_11_70&quot;         &quot;sample_10915_71&quot;  &quot;sample_99476_72&quot; 
##  [73] &quot;sample_14240_73&quot;  &quot;sample_68158_74&quot;  &quot;QC_12_75&quot;        
##  [76] &quot;sample_44297_76&quot;  &quot;sample_102649_77&quot; &quot;sample_43569_78&quot; 
##  [79] &quot;sample_110133_79&quot; &quot;QC_13_80&quot;         &quot;sample_82261_81&quot; 
##  [82] &quot;sample_91768_82&quot;  &quot;sample_75524_83&quot;  &quot;sample_41343_84&quot; 
##  [85] &quot;QC_14_85&quot;         &quot;sample_10078_86&quot;  &quot;sample_66518_87&quot; 
##  [88] &quot;sample_90107_88&quot;  &quot;sample_27336_89&quot;  &quot;QC_15_90&quot;        
##  [91] &quot;sample_111469_91&quot; &quot;sample_89994_92&quot;  &quot;sample_91108_93&quot; 
##  [94] &quot;sample_48921_94&quot;  &quot;QC_16_95&quot;         &quot;sample_3918_96&quot;  
##  [97] &quot;sample_111304_97&quot; &quot;sample_45723_98&quot;  &quot;sample_19738_99&quot; 
## [100] &quot;QC_17_100&quot;        &quot;sample_18558_101&quot; &quot;sample_85913_102&quot;
## [103] &quot;sample_21652_103&quot; &quot;sample_59941_104&quot; &quot;QC_18_105&quot;       
## [106] &quot;sample_36849_106&quot; &quot;sample_20031_107&quot; &quot;sample_50189_108&quot;
## [109] &quot;sample_43370_109&quot; &quot;blank_1_110&quot;      &quot;blank_2_111&quot;     
## [112] &quot;blank_3_112&quot;</code></pre>
<p>We can also identify the quality control samples and assign them to a new variable qcNames</p>
<pre class="sourceCode r"><code class="sourceCode r">qcNames &lt;-<span class="st"> </span><span class="kw">colnames</span>(peakTable)[<span class="kw">grep</span>(<span class="st">&quot;QC_&quot;</span>, <span class="kw">colnames</span>(peakTable))] 
<span class="co"># print the QC names</span>
qcNames</code></pre>
<pre><code>##  [1] &quot;QC_1_1&quot;    &quot;QC_2_2&quot;    &quot;QC_3_3&quot;    &quot;QC_4_4&quot;    &quot;QC_5_5&quot;   
##  [6] &quot;QC_6_6&quot;    &quot;QC_7_7&quot;    &quot;QC_8_8&quot;    &quot;QC_9_9&quot;    &quot;QC_10_10&quot; 
## [11] &quot;QC_11_15&quot;  &quot;QC_12_20&quot;  &quot;QC_13_25&quot;  &quot;QC_14_30&quot;  &quot;QC_15_35&quot; 
## [16] &quot;QC_16_40&quot;  &quot;QC_17_45&quot;  &quot;QC_18_50&quot;  &quot;QC_19_55&quot;  &quot;QC_20_60&quot; 
## [21] &quot;QC_10_65&quot;  &quot;QC_11_70&quot;  &quot;QC_12_75&quot;  &quot;QC_13_80&quot;  &quot;QC_14_85&quot; 
## [26] &quot;QC_15_90&quot;  &quot;QC_16_95&quot;  &quot;QC_17_100&quot; &quot;QC_18_105&quot;</code></pre>
<p>Then the sample names (assigned to sampNames)</p>
<pre class="sourceCode r"><code class="sourceCode r">sampNames &lt;-<span class="st"> </span><span class="kw">colnames</span>(peakTable)[<span class="kw">grep</span>(<span class="st">&quot;sample_&quot;</span>, <span class="kw">colnames</span>(peakTable))]
<span class="co"># print the sample names</span>
sampNames</code></pre>
<pre><code>##  [1] &quot;sample_90148_11&quot;  &quot;sample_20692_12&quot;  &quot;sample_105762_13&quot;
##  [4] &quot;sample_80259_14&quot;  &quot;sample_75940_16&quot;  &quot;sample_72889_17&quot; 
##  [7] &quot;sample_83233_18&quot;  &quot;sample_53839_19&quot;  &quot;sample_2492_21&quot;  
## [10] &quot;sample_61966_22&quot;  &quot;sample_84401_23&quot;  &quot;sample_16265_24&quot; 
## [13] &quot;sample_65762_26&quot;  &quot;sample_69316_27&quot;  &quot;sample_88848_28&quot; 
## [16] &quot;sample_25450_29&quot;  &quot;sample_63664_31&quot;  &quot;sample_65099_32&quot; 
## [19] &quot;sample_22679_33&quot;  &quot;sample_85614_34&quot;  &quot;sample_6115_36&quot;  
## [22] &quot;sample_31433_37&quot;  &quot;sample_63088_38&quot;  &quot;sample_44970_39&quot; 
## [25] &quot;sample_68093_41&quot;  &quot;sample_46969_42&quot;  &quot;sample_81427_43&quot; 
## [28] &quot;sample_41979_44&quot;  &quot;sample_35776_46&quot;  &quot;sample_74037_47&quot; 
## [31] &quot;sample_24059_48&quot;  &quot;sample_35644_49&quot;  &quot;sample_66742_51&quot; 
## [34] &quot;sample_26783_52&quot;  &quot;sample_59605_53&quot;  &quot;sample_26363_54&quot; 
## [37] &quot;sample_105320_56&quot; &quot;sample_80224_57&quot;  &quot;sample_60050_58&quot; 
## [40] &quot;sample_44059_59&quot;  &quot;sample_85303_61&quot;  &quot;sample_107459_62&quot;
## [43] &quot;sample_79428_63&quot;  &quot;sample_102682_64&quot; &quot;sample_73599_66&quot; 
## [46] &quot;sample_22777_67&quot;  &quot;sample_1587_68&quot;   &quot;sample_68869_69&quot; 
## [49] &quot;sample_10915_71&quot;  &quot;sample_99476_72&quot;  &quot;sample_14240_73&quot; 
## [52] &quot;sample_68158_74&quot;  &quot;sample_44297_76&quot;  &quot;sample_102649_77&quot;
## [55] &quot;sample_43569_78&quot;  &quot;sample_110133_79&quot; &quot;sample_82261_81&quot; 
## [58] &quot;sample_91768_82&quot;  &quot;sample_75524_83&quot;  &quot;sample_41343_84&quot; 
## [61] &quot;sample_10078_86&quot;  &quot;sample_66518_87&quot;  &quot;sample_90107_88&quot; 
## [64] &quot;sample_27336_89&quot;  &quot;sample_111469_91&quot; &quot;sample_89994_92&quot; 
## [67] &quot;sample_91108_93&quot;  &quot;sample_48921_94&quot;  &quot;sample_3918_96&quot;  
## [70] &quot;sample_111304_97&quot; &quot;sample_45723_98&quot;  &quot;sample_19738_99&quot; 
## [73] &quot;sample_18558_101&quot; &quot;sample_85913_102&quot; &quot;sample_21652_103&quot;
## [76] &quot;sample_59941_104&quot; &quot;sample_36849_106&quot; &quot;sample_20031_107&quot;
## [79] &quot;sample_50189_108&quot; &quot;sample_43370_109&quot;</code></pre>
<p>Then finally the blank sample names (assigned to blankNames).</p>
<pre class="sourceCode r"><code class="sourceCode r">blankNames &lt;-<span class="st"> </span><span class="kw">colnames</span>(peakTable)[<span class="kw">grep</span>(<span class="st">&quot;blank_&quot;</span>, <span class="kw">colnames</span>(peakTable))]
<span class="co"># print the blank names</span>
blankNames</code></pre>
<pre><code>## [1] &quot;blank_1_110&quot; &quot;blank_2_111&quot; &quot;blank_3_112&quot;</code></pre>
<p>Now that we have identified our observation column names we can now start the MetMSLine process by supplying the necessary arguments to the wrapper functions.</p>
</div>
<div id="lc-ms-peak-table-preprocessing." class="section level2">
<h2>1. LC-MS peak table preprocessing.</h2>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># detect number of cores using parallel package</span>
nCores &lt;-<span class="st"> </span>parallel::<span class="kw">detectCores</span>()
<span class="co"># conduct LC-MS data preprocessing</span>
preProc_peakTable &lt;-<span class="st"> </span><span class="kw">preProc</span>(peakTable, obsNames, sampNames, qcNames, blankNames,
                             <span class="dt">cvThresh=</span><span class="dv">30</span>, <span class="dt">nCores=</span>nCores)</code></pre>
<pre><code>## zero filling with half the minimum non-zero value
## 
## Median fold change normalization...
## 
## applying LOESS fit (7-fold CV) and signal drift/ attenuation smoothing...
## 
## Loading required package: foreach
## Starting SNOW cluster with 8 local sockets...
## 
## 7-fold cross validaton loess fitting will be applied to 5000 LC-MS features. Please wait...
## 
## 95 (1.9%) of the LC-MS variables contain one of more negative values following loess smoothing...
## 
## A column of logicals &quot;negVals&quot; will be added to the returned table indicating these...
## 
## Please examine and remove these potentially problematic features before proceeding with further analysis...
## 
## 
## removing 95 LC-MS features containing negative values following loess smoothing...
## 
## performing blank substraction using...
## 80 samples
## 3 blanks
## 
## 4905 (100%) of the LC-MS features were above the mean sample:blank fold change threshold of 2
## 
## calculating coefficient of variation...
## 
## 3714 (75.7%) features were below the CV% threshold of 30
## 
## log transforming to the base 2.718...</code></pre>
<p>The table returned from the preProc function contains three additional columns:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">tail</span>(<span class="kw">colnames</span>(preProc_peakTable), <span class="dt">n=</span><span class="dv">3</span>)</code></pre>
<pre><code>## [1] &quot;smoothSpanLoessFit&quot; &quot;meanFCsampBlank&quot;    &quot;coeffVar&quot;</code></pre>
<ol style="list-style-type: decimal">
<li><p>smoothSpanLoessFit: column contains the optimal loess smooth span parameter identified by 7-fold cross validation for each LC-MS variable.</p></li>
<li><p>meanFCsampBlank: the fold change value of samples:blanks.</p></li>
<li><p>coeffVar: the coefficient of variation (CV%) of the repeat pooled QC injections for each LC-MS variable.</p></li>
</ol>
<p>Furthermore, the original peakTable has also been subset and LC-MS variables which were below the sample:blank fold change threshold (the default is &gt;2 fold) or above the CV% threshold set (the default is 30%).</p>
<p>if you want to find out more about this wrapper function you can simply type ?MetMSLine::preProc in your R console and hit enter to see the help page.</p>
</div>
<div id="pca-based-automated-outlier-detection-and-cluster-identification." class="section level2">
<h2>2. PCA based automated outlier detection and cluster identification.</h2>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
